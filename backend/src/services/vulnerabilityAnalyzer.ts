import { Vulnerability, Severity } from '../types/index.js';

const SEVERITY_WEIGHTS: Record<Severity, number> = {
  Critical: 10,
  High: 7,
  Medium: 4,
  Low: 1,
};

export function calculateSecurityScore(vulnerabilities: Vulnerability[]): number {
  if (vulnerabilities.length === 0) {
    return 100;
  }

  // Calculate weighted sum
  const weightedSum = vulnerabilities.reduce((sum, vuln) => {
    return sum + SEVERITY_WEIGHTS[vuln.severity];
  }, 0);

  // Maximum possible weight (assuming worst case: all critical)
  const maxPossibleWeight = vulnerabilities.length * SEVERITY_WEIGHTS.Critical;

  // Calculate score: 100 - (weighted_sum / max_possible_weight * 100)
  const score = Math.max(0, Math.min(100, 100 - (weightedSum / maxPossibleWeight * 100)));

  // Round to nearest integer
  return Math.round(score);
}

export function categorizeVulnerabilities(
  vulnerabilities: Vulnerability[]
): Record<Severity, number> {
  const categories: Record<Severity, number> = {
    Critical: 0,
    High: 0,
    Medium: 0,
    Low: 0,
  };

  for (const vuln of vulnerabilities) {
    categories[vuln.severity]++;
  }

  return categories;
}

